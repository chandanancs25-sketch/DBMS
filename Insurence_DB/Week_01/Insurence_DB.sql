-- Week 01 Table Creation and insert Values
CREATE DATABASE Insurance_DataBase;
USE Insurance_DataBase;
 CREATE TABLE PERSON (
  driver_id VARCHAR(10) PRIMARY KEY,
  name VARCHAR(20),
  address VARCHAR(30)
 );-- CAR
 CREATE TABLE CAR (
  reg_num VARCHAR(10) PRIMARY KEY,
  model VARCHAR(20),
  year INT
 );-- ACCIDENT
 CREATE TABLE ACCIDENT (
  report_num INT PRIMARY KEY,
  accident_date DATE,
  location VARCHAR(50)
 );-- OWNS (relationship)
 CREATE TABLE OWNS (
  driver_id VARCHAR(10),
  reg_num VARCHAR(10),
  PRIMARY KEY (driver_id, reg_num),
  FOREIGN KEY (driver_id) REFERENCES PERSON(driver_id),
  FOREIGN KEY (reg_num) REFERENCES CAR(reg_num)
 );-- PARTICIPATED (relationship with damage)
 CREATE TABLE PARTICIPATED (
  driver_id VARCHAR(10),
  reg_num VARCHAR(10),
  report_num INT,
  damage_amount INT,
  PRIMARY KEY (driver_id, reg_num, report_num),
  FOREIGN KEY (driver_id) REFERENCES PERSON(driver_id),
  FOREIGN KEY (reg_num) REFERENCES CAR(reg_num),
  FOREIGN KEY (report_num) REFERENCES ACCIDENT(report_num)
 );

 INSERT INTO PERSON VALUES ('A01', 'Richard', 'Srinivas Nagar');
 INSERT INTO PERSON VALUES ('A02', 'Pradeep', 'Rajajinagar');
 INSERT INTO PERSON VALUES ('A03', 'Smith', 'Ashoknagar');
 INSERT INTO PERSON VALUES ('A04', 'Venu', 'N.R.Colony');
 INSERT INTO PERSON VALUES ('A05', 'John', 'Hanumanth Nagar');-- CAR (5 rows)
 
 INSERT INTO CAR VALUES ('KA052250', 'Indica', 1990);
 INSERT INTO CAR VALUES ('KA031181', 'Lancer', 1957);
 INSERT INTO CAR VALUES ('KA095477', 'Toyota', 1998);
 INSERT INTO CAR VALUES ('KA053408', 'Honda', 2008);
 INSERT INTO CAR VALUES ('KA041702', 'Audi', 2005);-- ACCIDENT (5 rows) -- use DATE literal format depending on RDBMS; here 'YYYY-MM-DD' is safe for
 
 INSERT INTO ACCIDENT VALUES (11, DATE '2003-01-01', 'Mysore Road');
 INSERT INTO ACCIDENT VALUES (12, DATE '2004-02-02', 'Southend Circle');
 INSERT INTO ACCIDENT VALUES (13, DATE '2003-01-21', 'Bulltemple Road');
 INSERT INTO ACCIDENT VALUES (14, DATE '2008-02-17', 'Mysore Road');
 INSERT INTO ACCIDENT VALUES (15, DATE '2005-03-04', 'Kanakpura Road');-- OWNS (5 rows)
 
 INSERT INTO OWNS VALUES ('A01', 'KA052250');
 INSERT INTO OWNS VALUES ('A02', 'KA053408');
 INSERT INTO OWNS VALUES ('A04', 'KA031181');
 INSERT INTO OWNS VALUES ('A03', 'KA095477');
 INSERT INTO OWNS VALUES ('A05', 'KA041702');-- PARTICIPATED (5 rows)
 
 INSERT INTO PARTICIPATED VALUES ('A01', 'KA052250', 11, 10000);
 INSERT INTO PARTICIPATED VALUES ('A02', 'KA053408', 12, 50000);
 INSERT INTO PARTICIPATED VALUES ('A03', 'KA095477', 13, 25000);
 INSERT INTO PARTICIPATED VALUES ('A04', 'KA031181', 14, 3000);
 INSERT INTO PARTICIPATED VALUES ('A05', 'KA041702', 15, 5000);

SHOW TABLES;
SELECT * FROM PERSON;
SELECT * FROM CAR;
SELECT * FROM ACCIDENT;

SELECT * FROM OWNS;

SELECT * FROM PARTICIPATED;

-- Week 2 Extra Queries 

 
 -- LIST THE ENTIRE PARTICIPATED RELATION IN THE DESCENDING ORDER OF DAMAGE AMOUNT.
 SELECT * FROM PARTICIPATED ORDER BY damage_amount DESC;

-- FIND THE AVERAGE DAMAGE AMOUNT
 SELECT AVG(damage_amount) FROM PARTICIPATED;

-- DELETE THE TUPLE WHOSE DAMAGE AMOUNT IS BELOW THE AVERAGE DAMAGE AMOUNT
DELETE FROM PARTICIPATED WHERE 
 damage_amount<  (SELECT AVG (damage_amount) FROM PARTICIPATED);

-- LIST THE NAME OF DRIVERS WHOSE DAMAGE IS GREATER THAN THE AVERAGE DAMAGE AMOUNT.
 SELECT NAME FROM PERSON A, PARTICIPATED B WHERE A.DRIVER_ID = B.DRIVER_ID AND DAMAGE_AMOUNT > (SELECT AVG(DAMAGE_AMOUNT) FROM PARTICIPATED);

-- FIND MAXIMUM DAMAGE AMOUNT.
SELECT MAX(DAMAGE_AMOUNT) FROM PARTICIPATED;

